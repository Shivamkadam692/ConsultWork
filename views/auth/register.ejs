<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= typeof title !== 'undefined' ? title : 'Register - Consultancy Service Portal' %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('../partials/navbar') %>
    <main>
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body p-5">
                    <h2 class="card-title text-center mb-4">Register</h2>
                    
                    <% if (typeof error !== 'undefined' && error) { %>
                        <div class="alert alert-danger"><%= error %></div>
                    <% } %>

                    <form action="/register" method="POST">
                        <div class="mb-3">
                            <label for="role" class="form-label">I want to</label>
                            <select class="form-select" id="role" name="role" required>
                                <option value="client">Find Services</option>
                                <option value="worker">Offer Services</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="firstName" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="firstName" name="firstName" 
                                    value="<%= typeof formData !== 'undefined' ? formData.firstName : '' %>" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="lastName" name="lastName"
                                    value="<%= typeof formData !== 'undefined' ? formData.lastName : '' %>" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email"
                                value="<%= typeof formData !== 'undefined' ? formData.email : '' %>" required>
                        </div>
                        <div class="mb-3">
                            <label for="phone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="phone" name="phone"
                                value="<%= typeof formData !== 'undefined' ? formData.phone : '' %>">
                        </div>
                        <div class="mb-3" id="workerFields" style="display: none;">
                            <!-- Add Your Skills Section -->
                            <div class="card mb-4">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0"><i class="bi bi-tools me-2"></i>Add Your Skills</h5>
                                </div>
                                <div class="card-body">
                                    <!-- Skills Section -->
                                    <div class="mb-3">
                                        <label class="form-label">Primary Skill *</label>
                                        <select class="form-select" name="primarySkill">
                                            <option value="">Select Primary Skill</option>
                                            <option value="Plumbing">Plumbing</option>
                                            <option value="Electrical">Electrical</option>
                                            <option value="Carpentry">Carpentry</option>
                                            <option value="Tutoring">Tutoring</option>
                                            <option value="Cleaning">Cleaning</option>
                                            <option value="Painting">Painting</option>
                                            <option value="Gardening">Gardening</option>
                                            <option value="HVAC">HVAC</option>
                                            <option value="Roofing">Roofing</option>
                                            <option value="Flooring">Flooring</option>
                                            <option value="Other">Other</option>
                                        </select>
                                        <small class="form-text text-muted">Select your primary skill/service</small>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Years of Experience *</label>
                                        <input type="number" class="form-control" name="experience" min="0" max="50" value="0">
                                        <small class="form-text text-muted">Enter the number of years you have experience in your primary skill</small>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Secondary Skills (Optional)</label>
                                        <input type="text" class="form-control" name="secondarySkills" placeholder="e.g., Electrical, Painting (comma separated)">
                                        <small class="form-text text-muted">Enter additional skills separated by commas</small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Add Your Location Section -->
                            <div class="card mb-4">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0"><i class="bi bi-geo-alt me-2"></i>Add Your Location</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Service City *</label>
                                        <input type="text" class="form-control" name="serviceCity" placeholder="e.g., New York">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Service Radius (km) *</label>
                                        <input type="number" class="form-control" name="serviceRadius" min="1" max="100" value="10">
                                        <small class="form-text text-muted">How far are you willing to travel for service?</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" name="password" required 
                                   pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$">
                            <small class="form-text text-muted">
                                Password must be at least 8 characters and include:
                                <ul class="mb-0 mt-1">
                                    <li>At least one uppercase letter (A-Z)</li>
                                    <li>At least one lowercase letter (a-z)</li>
                                    <li>At least one number (0-9)</li>
                                    <li>At least one special character (@$!%*?&)</li>
                                </ul>
                            </small>
                            <div id="passwordFeedback" class="invalid-feedback"></div>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                            <div id="confirmPasswordFeedback" class="invalid-feedback"></div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mb-3" id="submitBtn">Register</button>
                    </form>
                    <script>
                        // Client-side password validation
                        const password = document.getElementById('password');
                        const confirmPassword = document.getElementById('confirmPassword');
                        const passwordFeedback = document.getElementById('passwordFeedback');
                        const confirmPasswordFeedback = document.getElementById('confirmPasswordFeedback');
                        const submitBtn = document.getElementById('submitBtn');

                        function validatePassword() {
                            const value = password.value;
                            const errors = [];
                            
                            if (value.length < 8) {
                                errors.push('At least 8 characters');
                            }
                            if (!/[a-z]/.test(value)) {
                                errors.push('One lowercase letter');
                            }
                            if (!/[A-Z]/.test(value)) {
                                errors.push('One uppercase letter');
                            }
                            if (!/\d/.test(value)) {
                                errors.push('One number');
                            }
                            if (!/[@$!%*?&]/.test(value)) {
                                errors.push('One special character (@$!%*?&)');
                            }
                            
                            if (errors.length > 0) {
                                password.classList.add('is-invalid');
                                passwordFeedback.textContent = 'Missing: ' + errors.join(', ');
                                return false;
                            } else {
                                password.classList.remove('is-invalid');
                                password.classList.add('is-valid');
                                passwordFeedback.textContent = '';
                                return true;
                            }
                        }

                        function validateConfirmPassword() {
                            if (confirmPassword.value !== password.value) {
                                confirmPassword.classList.add('is-invalid');
                                confirmPasswordFeedback.textContent = 'Passwords do not match';
                                return false;
                            } else {
                                confirmPassword.classList.remove('is-invalid');
                                confirmPassword.classList.add('is-valid');
                                confirmPasswordFeedback.textContent = '';
                                return true;
                            }
                        }

                        password.addEventListener('input', validatePassword);
                        confirmPassword.addEventListener('input', validateConfirmPassword);

                        // Show/hide worker fields based on role selection
                        const roleSelect = document.getElementById('role');
                        const workerFields = document.getElementById('workerFields');
                        
                        roleSelect.addEventListener('change', function() {
                            if (this.value === 'worker') {
                                workerFields.style.display = 'block';
                            } else {
                                workerFields.style.display = 'none';
                            }
                        });
                        
                        // Initialize on page load
                        if (roleSelect.value === 'worker') {
                            workerFields.style.display = 'block';
                        }

                        document.querySelector('form').addEventListener('submit', function(e) {
                            if (!validatePassword() || !validateConfirmPassword()) {
                                e.preventDefault();
                                return false;
                            }
                            
                            // Validate worker fields if role is worker
                            if (roleSelect.value === 'worker') {
                                const primarySkill = document.querySelector('select[name="primarySkill"]');
                                const experience = document.querySelector('input[name="experience"]');
                                const serviceCity = document.querySelector('input[name="serviceCity"]');
                                const serviceRadius = document.querySelector('input[name="serviceRadius"]');
                                
                                if (!primarySkill.value) {
                                    alert('Please select your primary skill');
                                    e.preventDefault();
                                    return false;
                                }
                                
                                if (!serviceCity.value) {
                                    alert('Please enter your service city');
                                    e.preventDefault();
                                    return false;
                                }
                                
                                if (!serviceRadius.value || serviceRadius.value < 1) {
                                    alert('Please enter a valid service radius');
                                    e.preventDefault();
                                    return false;
                                }
                            }
                        });
                    </script>

                    <hr class="my-4">
                    <p class="text-center mb-0">Already have an account? <a href="/login">Login here</a></p>
                </div>
            </div>
        </div>
    </div>
</div>
    </main>
    <%- include('../partials/footer') %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>

